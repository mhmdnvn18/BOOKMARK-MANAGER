<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bookmark Manager</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <script>
        if (!localStorage.getItem('loggedIn')) {
            window.location.href = 'login.html';
        }
    </script>
    <header>
        <h1>Bookmark Manager</h1>
        <button class="logout-button" onclick="logout()">Logout</button>
    </header>
    <main>
        <section id="add-bookmark">
            <h2>Add Bookmark</h2>
            <form id="bookmark-form">
                <label for="title">Title</label>
                <input type="text" id="title" placeholder="Title" required>
                <label for="url">URL</label>
                <input type="url" id="url" placeholder="URL" required>
                <label for="category">Category</label>
                <select id="category" required>
                    <option value="" disabled selected>Select Category</option>
                    <option value="Work">Work</option>
                    <option value="Personal">Personal</option>
                    <option value="Education">Education</option>
                    <option value="Entertainment">Entertainment</option>
                </select>
                <button type="submit">Add Bookmark</button>
            </form>
        </section>
        <section id="edit-bookmark">
            <h2>Edit Bookmark</h2>
            <form id="edit-bookmark-form">
                <label for="edit-title">Title</label>
                <input type="text" id="edit-title" placeholder="Title" required>
                <label for="edit-url">URL</label>
                <input type="url" id="edit-url" placeholder="URL" required>
                <label for="edit-category">Category</label>
                <select id="edit-category" required>
                    <option value="" disabled selected>Select Category</option>
                    <option value="Work">Work</option>
                    <option value="Personal">Personal</option>
                    <option value="Education">Education</option>
                    <option value="Entertainment">Entertainment</option>
                </select>
                <button type="submit">Save Changes</button>
            </form>
        </section>
        <section id="bookmarks">
            <h2>Bookmarks</h2>
            <div id="bookmark-list"></div>
        </section>
    </main>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc, doc, deleteDoc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDSyI1drQSWkU1192Ol_7UnOztxxTZkerQ",
            authDomain: "bookmark-manager-7c5ab.firebaseapp.com",
            projectId: "bookmark-manager-7c5ab",
            storageBucket: "bookmark-manager-7c5ab.firebasestorage.app",
            messagingSenderId: "1098246411927",
            appId: "1:1098246411927:web:9a44915017f9d35fbefbd2",
            measurementId: "G-YF6CS3N1C6"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('bookmark-form');
            const editForm = document.getElementById('edit-bookmark-form');
            const bookmarkList = document.getElementById('bookmark-list');
            let editIndex = null;

            async function displayBookmarks() {
                bookmarkList.innerHTML = '';
                const querySnapshot = await getDocs(collection(db, 'bookmarks'));
                const categories = {};
                querySnapshot.forEach((doc) => {
                    const bookmark = doc.data();
                    if (!categories[bookmark.category]) {
                        categories[bookmark.category] = [];
                    }
                    categories[bookmark.category].push({ ...bookmark, id: doc.id });
                });

                const categoryContainer = document.createElement('div');
                categoryContainer.classList.add('category-container');

                for (const category in categories) {
                    const categorySection = document.createElement('div');
                    categorySection.classList.add('category-section');
                    categorySection.innerHTML = `<h3 class="category-title">${category}</h3>`;

                    categories[category].forEach(bookmark => {
                        const bookmarkElement = document.createElement('div');
                        bookmarkElement.classList.add('bookmark-card');
                        bookmarkElement.innerHTML = `
                            <img src="https://www.google.com/s2/favicons?domain=${new URL(bookmark.url).hostname}" class="bookmark-preview" alt="Website Preview">
                            <div class="bookmark-details">
                                <span class="bookmark-title">${bookmark.title}</span>
                                <a href="${bookmark.url}" class="bookmark-url" target="_blank">${bookmark.url}</a>
                                <span class="bookmark-category">${bookmark.category}</span>
                            </div>
                            <div>
                                <button class="edit" onclick="editBookmark('${bookmark.id}')">Edit</button>
                                <button onclick="deleteBookmark('${bookmark.id}')">Delete</button>
                            </div>
                        `;
                        categorySection.appendChild(bookmarkElement);
                    });

                    categoryContainer.appendChild(categorySection);
                }

                bookmarkList.appendChild(categoryContainer);
            }

            window.deleteBookmark = async function(id) {
                await deleteDoc(doc(db, 'bookmarks', id));
                displayBookmarks();
            }

            window.editBookmark = async function(id) {
                editIndex = id;
                const docSnap = await getDoc(doc(db, 'bookmarks', id));
                const bookmark = docSnap.data();
                document.getElementById('edit-title').value = bookmark.title;
                document.getElementById('edit-url').value = bookmark.url;
                document.getElementById('edit-category').value = bookmark.category;
                document.getElementById('edit-bookmark').style.display = 'block';
            }

            editForm.addEventListener('submit', async function(event) {
                event.preventDefault();
                const title = document.getElementById('edit-title').value;
                const url = document.getElementById('edit-url').value;
                const category = document.getElementById('edit-category').value;
                await updateDoc(doc(db, 'bookmarks', editIndex), { title, url, category });
                displayBookmarks();
                editForm.reset();
                document.getElementById('edit-bookmark').style.display = 'none';
            });

            form.addEventListener('submit', async function(event) {
                event.preventDefault();
                const title = document.getElementById('title').value;
                const url = document.getElementById('url').value;
                const category = document.getElementById('category').value;
                console.log('Adding bookmark:', { title, url, category });
                try {
                    await addDoc(collection(db, 'bookmarks'), { title, url, category });
                    console.log('Bookmark added successfully');
                    displayBookmarks();
                    form.reset();
                } catch (error) {
                    console.error('Error adding bookmark:', error);
                }
            });

            window.logout = function() {
                localStorage.removeItem('loggedIn');
                window.location.href = 'login.html';
            }

            displayBookmarks();
        });
    </script>
</body>
</html>